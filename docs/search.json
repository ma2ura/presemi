[
  {
    "objectID": "prezemi_2023_08_presen.html#準備",
    "href": "prezemi_2023_08_presen.html#準備",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "準備",
    "text": "準備\n必要なパッケージと設定。無ければインストールする。\n\n# 文字化け防止のおまじない、R 4.1.0以降\nknitr::opts_chunk$set(dev = \"ragg_png\")\nlibrary(tidyverse) # とりあえずこれ\nlibrary(ggthemes) # ggplot2のテーマ\nlibrary(knitr) # 作表\nlibrary(kableExtra) # 作表の拡張\nlibrary(scales) # 軸の単位を制御\n# テーマを設定\ntheme_set(theme_few(base_size = 12))\n# 以下、ggplot2のデフォルトを変更\nupdate_geom_defaults(\"point\", list(size = 3))"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#データの読み込み",
    "href": "prezemi_2023_08_presen.html#データの読み込み",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "データの読み込み",
    "text": "データの読み込み\n作業ディレクトリを確認・設定する。\n\ngetwd()\nsetwd(\"hoge\")\n\n任意のフォルダを作業ディレクトリとして指定しておく。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#データの読み込み-1",
    "href": "prezemi_2023_08_presen.html#データの読み込み-1",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "データの読み込み",
    "text": "データの読み込み\n今回は松浦のウェブサイトからデータを読み込ませる。\n\ndf &lt;- read_csv(\"https://so-ichi.com/presemi08_full.csv\")\nrmarkdown::paged_table(df, options = list(rows.print = 5, cols.print = 3))\n\n\n\n  \n\n\n\n小さなデータを読み込むときは、presemi08_full.csvのところをpresemi08_2018.csvに変える。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#自作関数を作る練習",
    "href": "prezemi_2023_08_presen.html#自作関数を作る練習",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "自作関数を作る練習",
    "text": "自作関数を作る練習\n関数を作るには，function()を使う。 引数は，function(引数1, 引数2, ...)とする。\n\nmyfunc &lt;- function(x){ # 関数名\n  # 何かしらの処理\n  # y = f(x)\n  return(y) # 返り値\n}"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#足し算をする関数",
    "href": "prezemi_2023_08_presen.html#足し算をする関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "足し算をする関数",
    "text": "足し算をする関数\n変数yとxを足す，という関数addを作るとする。\n\nadd &lt;- function(y, x){\n  y + x\n}\n\n使ってみる。\n\n\nadd(1,4)\n\n\n[1] 5"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#分散を計算する関数",
    "href": "prezemi_2023_08_presen.html#分散を計算する関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "分散を計算する関数",
    "text": "分散を計算する関数\n\nデータの個数は，ベクトルならlength()，データフレームならnrow()\n合計はsum()，あるいはfor()で力尽くで計算\n\n\nmyvar &lt;- function(x) { # 自作関数 myvar\n  n = length(x) # データの個数\n  m = mean(x) # 平均\n  v = (sum((x - m)^2)) / n # 分散の定義\n  return(v) # 返り値\n}\n\n使ってみる。\n\n\nmyvar(c(1,2,3,4,5))\n\n\n[1] 2"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#合計を計算する方法",
    "href": "prezemi_2023_08_presen.html#合計を計算する方法",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "合計を計算する方法",
    "text": "合計を計算する方法\n1から10までの整数の合計を計算する。 sum()関数を使えば簡単。\n\n\nx &lt;- c(1:10) # 1〜10までの整数\nsum(x) # 合計\n\n\n[1] 55\n\n\n\nでもあえてforループをとすると、\n\ns &lt;- 0 # 初期値\nfor(i in 1:length(x)){ # ループ\n    s &lt;- s + x[i] # 合計\n}\nprint(s) # 結果\n\n[1] 55"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#平均を計算する関数",
    "href": "prezemi_2023_08_presen.html#平均を計算する関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "平均を計算する関数",
    "text": "平均を計算する関数\n\nmymean &lt;- function(x){\n  n = length(x) # データの個数\n  s = 0 # 初期値\n  for(i in 1:length(x)){ # ループ\n    s &lt;- s + x[i] # 合計をsに足していく\n  }\n  sumx &lt;- s / n # 平均\n  return(sumx) # 返り値\n}\n\n使ってみる。\n\n\nmymean(x)\n\n\n[1] 5.5\n\n\n\n基本関数mean()を使えば簡単に計算できる。\n\n\nmean(x) # 一撃\n\n\n[1] 5.5"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#tidyverseで自作関数",
    "href": "prezemi_2023_08_presen.html#tidyverseで自作関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "tidyverseで自作関数",
    "text": "tidyverseで自作関数\ntidyverseで自作関数を作る場合、注意が必要である。 例として、平均、分散、標準偏差を計算する関数mystat()を作る。\n\nmystat &lt;- function(chu, item) { # 引数をchuとitem\n  df |&gt; # データフレーム\n    filter(中分類 == chu) |&gt; # 指定した中分類を抽出\n    summarise( # 統計量を計算\n      平均     = mean(!!sym(item)), # 平均\n      中央値   = median(!!sym(item)), # 分散\n      標準偏差 = sd(!!sym(item)) # 標準偏差\n    ) |&gt;\n    kable() |&gt; kable_styling(font_size = 30) # 作表\n}"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#自作関数を使う",
    "href": "prezemi_2023_08_presen.html#自作関数を使う",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "自作関数を使う。",
    "text": "自作関数を使う。\n\nmystat(\"精密機器\", \"売上高\") # \"\"で囲まないとエラー\n\n\n\n\n平均\n中央値\n標準偏差\n\n\n\n\n115180.1\n22468.5\n216197.7\n\n\n\n\n\n\n\n平均値が中央値よりかなり大きいため，大きな値のため分布が右に歪んでいることが分かる。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#注意点",
    "href": "prezemi_2023_08_presen.html#注意点",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "注意点",
    "text": "注意点\n!!sym()は何をしているのか？\n\nsym()は、文字列をシンボル（変数名）に変換すること\nプログラム的に変数名を操作し、データフレームにおける列の操作を動的に実行可能\n!!は非標準評価(NSE)によりシンボルを実際の列として評価させている。\n\nまぁ細かいことなので，今は理解できなくてもよいです。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#例1",
    "href": "prezemi_2023_08_presen.html#例1",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "例1",
    "text": "例1\nたとえば，tidyverseの各種パッケージで，外からの文字列を使う場合\n\nseimitsu &lt;- \"精密機器\"\ndf |&gt; filter(中分類 == seimitsu) |&gt;\nrmarkdown::paged_table(options = list(rows.print = 4, cols.print = 4))\n\n\n\n  \n\n\n\nこれはOK"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#例2",
    "href": "prezemi_2023_08_presen.html#例2",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "例2",
    "text": "例2\n\nsales &lt;- \"売上高\"\ndf |&gt;\n  ggplot() + aes(x = sales) +\n  geom_histogram()\n\nこれはエラーがでる。 salesに”売上高”を代入する際にエラーになるため，ggplot()に渡すことができない。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#折れ線グラフを作る関数",
    "href": "prezemi_2023_08_presen.html#折れ線グラフを作る関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "折れ線グラフを作る関数",
    "text": "折れ線グラフを作る関数\n特定企業の，特定項目のデータから折れ線グラフを作る関数myline()を作る。\n\nmyline &lt;- function(name, item) {\n  df |&gt;\n    filter(企業名称 == name) |&gt;\n    select(年度, !!sym(item)) |&gt;\n    ggplot(aes(x = 年度, y = !!sym(item), group = 1)) +\n    geom_line() + geom_point() +\n    labs(title = paste(name, item, sep = \" \"), x = \"年度\", y = item) +\n    scale_y_continuous(labels = label_number(scale = 1/100, suffix = '億')) + # 単位\n    theme_economist(base_family = \"HiraKakuProN-W3\") +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))\n}"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#折れ線グラフを作る関数-1",
    "href": "prezemi_2023_08_presen.html#折れ線グラフを作る関数-1",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "折れ線グラフを作る関数",
    "text": "折れ線グラフを作る関数\n\nmyline(\"トヨタ自動車\", \"売上高\")"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#日産も作ってみる",
    "href": "prezemi_2023_08_presen.html#日産も作ってみる",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "日産も作ってみる。",
    "text": "日産も作ってみる。\n\nmyline(\"日産自動車\", \"売上高\")"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#並べてみる",
    "href": "prezemi_2023_08_presen.html#並べてみる",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "並べてみる",
    "text": "並べてみる\n\n\nRコード\ng1 &lt;- myline(\"トヨタ自動車\", \"売上高\")\ng2 &lt;- myline(\"日産自動車\", \"売上高\")\nlibrary(patchwork)\n# y軸をそろえる\n(g1 + g2) * ylim(0, 40000000)"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#ヒストグラムを作る関数",
    "href": "prezemi_2023_08_presen.html#ヒストグラムを作る関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "ヒストグラムを作る関数",
    "text": "ヒストグラムを作る関数\n\nmyhist &lt;- function(chu, item) { # 産業と項目を指定\ndf_chu &lt;- df |&gt;\n    filter(中分類 == chu) # 中分類を指定\ndf_chu |&gt; ggplot() + aes(x = !!sym(item)) + # ggplot\n      geom_histogram(bins = 20) + # ヒストグラム\n      labs(\n        title = paste(chu, item, sep = \" \"), # タイトル\n        x = item, y = \"頻度\") # 軸ラベル\n}"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#ヒストグラムを作る関数-1",
    "href": "prezemi_2023_08_presen.html#ヒストグラムを作る関数-1",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "ヒストグラムを作る関数",
    "text": "ヒストグラムを作る関数\n\nmyhist(\"精密機器\", \"売上高\")"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#製造業-vs-非製造業",
    "href": "prezemi_2023_08_presen.html#製造業-vs-非製造業",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "製造業 vs 非製造業",
    "text": "製造業 vs 非製造業\n製造業と非製造業で売上高利益率が違うかどうかの検定を行う。 いきなり計算するのではなく，まずはデータを見てみる。\n\nsummary(df$売上高)\n\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n       0     8134    25930   190128    91764 37154298 \n\n\n売上高ゼロはまずいので，あとで除外する。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#製造業-vs-非製造業-1",
    "href": "prezemi_2023_08_presen.html#製造業-vs-非製造業-1",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "製造業 vs 非製造業",
    "text": "製造業 vs 非製造業\n\nsummary(df$親会社利益)\n\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n-2008074      117      618     6485     2677  4987962 \n\n\n赤字企業も利益率を計算する上で邪魔なので，除外する。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#製造業-vs-非製造業-2",
    "href": "prezemi_2023_08_presen.html#製造業-vs-非製造業-2",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "製造業 vs 非製造業",
    "text": "製造業 vs 非製造業\n\ndf_test &lt;- df |&gt;\n  filter(売上高 &gt; 0, 親会社利益 &gt; 0) |&gt; # 異常値を除外\n  mutate( 売上高利益率 = 親会社利益 / 売上高 ) # 利益率計算\ndf_mean &lt;- df_test |&gt;\n  group_by(大分類) |&gt;\n  summarise(\n    平均利益率 = round(mean(売上高利益率, na.rm = TRUE), digits = 3)\n    )\ndf_mean |&gt; kable() |&gt; kable_styling(font_size = 30)\n\n\n\n\n大分類\n平均利益率\n\n\n\n\n1\n0.053\n\n\n2\n0.068"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#比較",
    "href": "prezemi_2023_08_presen.html#比較",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "比較",
    "text": "比較\n大分類1は製造業で，利益率が2，非製造業は0.068であることから，サービス業の方が売上高利益率が高いことがわかる。\nこの差は，\n\n同じ母集団から，偶然の差？\n違う母集団から，当然の差？\n\n\\(t\\)検定してみる。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#製造業-vs-非製造業-3",
    "href": "prezemi_2023_08_presen.html#製造業-vs-非製造業-3",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "製造業 vs 非製造業",
    "text": "製造業 vs 非製造業\n\nt.test(#\n  df_test$売上高利益率[df_test$大分類 == 1], # var1\n  df_test$売上高利益率[df_test$大分類 == 2], # var2\n  )\n\n\n    Welch Two Sample t-test\n\ndata:  df_test$売上高利益率[df_test$大分類 == 1] and df_test$売上高利益率[df_test$大分類 == 2]\nt = -6.8123, df = 32435, p-value = 9.769e-12\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -0.01916433 -0.01060046\nsample estimates:\n mean of x  mean of y \n0.05290615 0.06778855"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#ヒストグラムを重ねてみる",
    "href": "prezemi_2023_08_presen.html#ヒストグラムを重ねてみる",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "ヒストグラムを重ねてみる。",
    "text": "ヒストグラムを重ねてみる。\n\n\nRコード\nseizou &lt;- mean(df_test$売上高利益率[df_test$大分類 == 1])\nhisei &lt;- mean(df_test$売上高利益率[df_test$大分類 == 2])\ndf_test |&gt;\n  ggplot(aes(x = 売上高利益率,y = ..density.., # 軸\n  group = factor(大分類), fill = factor(大分類))) + # グループ\n  geom_histogram(binwidth = 0.01, alpha = 0.5) + # ヒストグラム\n  xlim(0, 0.5) + # x軸の範囲\n  geom_vline( # 平均値の直線を引く\n    xintercept = c(seizou, hisei), # 平均値\n    linetype = \"dashed\",\n    color = c(\"red\", \"blue\")) +\n  scale_y_continuous(expand = c(0,0)) + # 余白を削除\n  labs(title = \"売上高利益率のヒストグラム\", x = \"売上高利益率\", y = \"頻度\")"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#相関係数",
    "href": "prezemi_2023_08_presen.html#相関係数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "相関係数",
    "text": "相関係数\n2つの連続変数の線形関係を示す指標として，相関係数(correlation coefficient)がある。 \\(x\\)と\\(y\\)の2変数の(ピアソンの積率)相関係数は以下のように定義される。 \\[\nr = \\frac{\\sum_{i=1}^{n}(x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n}(x_i - \\bar{x})^2}\\sqrt{\\sum_{i=1}^{n}(y_i - \\bar{y})^2}} = \\frac{\\mathrm{cov}(x,y)}{\\sigma_x \\times \\sigma _y}\n\\]"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#相関係数の種類",
    "href": "prezemi_2023_08_presen.html#相関係数の種類",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "相関係数の種類",
    "text": "相関係数の種類\n相関係数にはいくつか種類があり，代表的なものとして，\n\nピアソンの積率相関係数 : パラメトリック\nスピアマンの順位相関係数 : ノンパラメトリック\n\n通常「相関係数」というとピアソンの積率相関係数を意味する。 Rで計算するなら，cor()を用いる。 引数として連続変数を2つとる。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#相関係数の計算",
    "href": "prezemi_2023_08_presen.html#相関係数の計算",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "相関係数の計算",
    "text": "相関係数の計算\n\n\ndf_test |&gt; with(cor(売上高, 広告宣伝費))\n\n\n[1] 0.5848697\n\n\n\n散布図も書いてみる。\n\n\nRコード\ndf_test |&gt;\n  filter(広告宣伝費 &gt; 0) |&gt;\n  ggplot() + aes(x = 広告宣伝費, y = 売上高) +\n  geom_point()"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#変数変換",
    "href": "prezemi_2023_08_presen.html#変数変換",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "変数変換",
    "text": "変数変換\n右下にデータが集まりすぎているので，対数変換してみる。\n\n\nRコード\ndf_test |&gt;\n  filter(広告宣伝費 &gt; 0) |&gt;\n  ggplot() + aes(x = log(広告宣伝費), y = log(売上高)) +\n  geom_point()\n\n\n\n右肩上がりの関係が見えてきます。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#前期の値",
    "href": "prezemi_2023_08_presen.html#前期の値",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "前期の値",
    "text": "前期の値\n当期の広告宣伝費より昨年度の広告宣伝費のほうが当期の売上高に影響を与えているかも。\n\n\nRコード\ndf_test |&gt;\n  filter(広告宣伝費 &gt; 0) |&gt;\n  ggplot() + aes(x = log(lag(広告宣伝費)), y = log(売上高)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE)"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#前期の広告宣伝費",
    "href": "prezemi_2023_08_presen.html#前期の広告宣伝費",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "前期の広告宣伝費",
    "text": "前期の広告宣伝費\n当期より昨年度の広告宣伝費のほうが当期の売上高に影響を与えているかもしれないので、 lag()関数を使って作図してみる。\n\n\nRコード\ndf_test |&gt;\n  filter(広告宣伝費 &gt; 0) |&gt;\n  ggplot() + aes(x = log(lag(広告宣伝費)), y = log(売上高)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE)"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#対数変換の効果",
    "href": "prezemi_2023_08_presen.html#対数変換の効果",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "対数変換の効果",
    "text": "対数変換の効果\n(自然)対数変換の効果を確認してみる。\n\n\nRコード\nz &lt;- c(1:100)\nlogz &lt;- log(z)\n# 2つのグラフを並べる\npar(mfrow = c(1,2))\nplot(z)\nplot(logz)"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#指数関数とは",
    "href": "prezemi_2023_08_presen.html#指数関数とは",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "指数関数とは",
    "text": "指数関数とは\n対数の前に、指数関数(exponential function)を説明する。 指数関数とは，\\(y\\)が正の実数のとき，\\(x = \\mathrm{a}^y\\)となる関数\\(f:y \\mapsto x\\)である。 定数\\(a\\)を\\(y\\)乗すると\\(x\\)になる関数である。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#対数関数",
    "href": "prezemi_2023_08_presen.html#対数関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "対数関数",
    "text": "対数関数\n逆に、\\(x\\)が正の実数のとき，\\(y = \\log x\\)となる\\(y\\)のことを対数(logarithm)といい、 対数関数とは，\\(y = \\log x\\)となる関数\\(f:x \\mapsto y\\)のことである。"
  },
  {
    "objectID": "prezemi_2023_08_presen.html#指数関数と対数関数",
    "href": "prezemi_2023_08_presen.html#指数関数と対数関数",
    "title": "プレゼミ2023  第8回 分析してみよう",
    "section": "指数関数と対数関数",
    "text": "指数関数と対数関数\n\\[\nt = \\log x \\Longleftrightarrow x = \\mathrm{e}^t\n\\] つまり、指数関数と対数関数は逆関数なので、\n\\[\n\\begin{aligned}\nt = \\log x = \\log \\mathrm{e}^t\\\\\nx = \\mathrm{e}^t = \\mathrm{e}^{\\log x}\n\\end{aligned}\n\\] が成り立つ。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#準備",
    "href": "prezemi_2023_09_presen.html#準備",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "準備",
    "text": "準備\n必要なパッケージと設定。無ければインストールする。\n\n# 文字化け防止のおまじない、R 4.1.0以降\nknitr::opts_chunk$set(dev = \"ragg_png\")\nlibrary(tidyverse) # とりあえずこれ\nlibrary(ggthemes) # ggplot2のテーマ\nlibrary(knitr) # 作表\nlibrary(kableExtra) # 作表の拡張\nlibrary(scales) # 軸の単位を制御\n# テーマを設定\ntheme_set(theme_few(base_size = 12))\n# 以下、ggplot2のデフォルトを変更\nupdate_geom_defaults(\"point\", list(size = 3))"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#データの読み込み",
    "href": "prezemi_2023_09_presen.html#データの読み込み",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "データの読み込み",
    "text": "データの読み込み\n作業ディレクトリを確認・設定する。\n\ngetwd()\nsetwd(\"hoge\")\n\n任意のフォルダを作業ディレクトリとして指定しておく。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#データの読み込み-1",
    "href": "prezemi_2023_09_presen.html#データの読み込み-1",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "データの読み込み",
    "text": "データの読み込み\n今回は松浦のウェブサイトからデータを読み込ませる。\n\ndf &lt;- read_csv(\"https://so-ichi.com/presemi08_full.csv\")\nrmarkdown::paged_table(df, options = list(rows.print = 5, cols.print = 3))\n\n\n\n  \n\n\n\n小さなデータを読み込むときは、presemi08_full.csvのところをpresemi08_2018.csvに変える。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カテゴリー変数の関連",
    "href": "prezemi_2023_09_presen.html#カテゴリー変数の関連",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カテゴリー変数の関連",
    "text": "カテゴリー変数の関連\n\nこの章では、2つ以上の変数間の関係を調べる方法を学びます。\n1つめは、カテゴリー変数間の関係を調べる方法として、クロス集計表とカイ二乗検定を学びます。\n2つめは、量的変数間の関係を調べる方法として、相関係数と散布図を学びます。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#クロス集計表",
    "href": "prezemi_2023_09_presen.html#クロス集計表",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "クロス集計表",
    "text": "クロス集計表\n\nカテゴリー変数は、その値がどのカテゴリーに属するかということを表す変数\n2つのカテゴリー変数の関連性を調べるためにはクロス集計表を作ることが有益\n\n\n\n\n\nメガネかけてる\nかけてない\n合計\n\n\n\n\n男\n41\n204\n245\n\n\n女\n81\n74\n155\n\n\n合計\n122\n278\n400\n\n\n\nこの表から、メガネをかけている人の割合は、男性の中で\\(41 \\div 204 =\\) 0.2009804、 女性の中で\\(81 \\div 155 =\\) 0.52であることから、女子学生の方がメガネをかける傾向にあることが分かりました。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗検定",
    "href": "prezemi_2023_09_presen.html#カイ二乗検定",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗検定",
    "text": "カイ二乗検定\nこのクロス集計表から読み取れる関係が、統計的に意味があるのかどうかを調べるためには、\\(\\chi ^2\\)(カイ二乗)検定を行います。\n\n帰無仮説として、カテゴリー変数間に関連性はないと仮定\nその仮定のもとで、観測されたクロス集計表の度数が、理論的に予測される度数と大きく異なるかどうかを検定\n予測される度数と観測された度数の差が大きいほど、帰無仮説が棄却される\n\n\\(\\chi^2\\)検定で用いられる統計量は、\\(\\chi^2\\)統計量と呼ばれ、次の式で計算されます。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗の数式",
    "href": "prezemi_2023_09_presen.html#カイ二乗の数式",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗の数式",
    "text": "カイ二乗の数式\n\\[\n\\chi^2 = \\sum_{i=1}^n \\sum_{j=1}^m \\frac{(O_{ij} - E_{ij})^2}{E_{ij}}\n\\]\nここで、\\(O_{ij}\\)は観測された度数(観測度数)、\\(E_{ij}\\)は理論的に予測される度数(期待度数)です。\\(n\\)と\\(m\\)はカテゴリー変数のカテゴリー数です。 つまり、2つのカテゴリー変数の関連性を調べる場合、\\(\\chi^2\\)統計量は次のように計算されます。\n\\[\n\\begin{aligned}\n\\chi^2 &= \\frac{(O_{11} - E_{11})^2}{E_{11}} + \\frac{(O_{12} - E_{12})^2}{E_{12}} \\\\\n&+ \\frac{(O_{21} - E_{21})^2}{E_{21}} + \\frac{(O_{22} - E_{22})^2}{E_{22}}\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#期待度数",
    "href": "prezemi_2023_09_presen.html#期待度数",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "期待度数",
    "text": "期待度数\nここで、期待度数\\(E\\)をどうやって求めるのか、が問題となります。 期待度数の「期待」の意味は、帰無仮説のもとで期待される度数です。\n\\[\nE_{ij} = \\frac{O_{i\\cdot} \\times O_{\\cdot j}}{O_{\\cdot \\cdot}}\n\\] ここで、\\(O_{i\\cdot}\\)は\\(i\\)行目の合計(横の合計)、\\(O_{\\cdot j}\\)は\\(j\\)列目の合計(縦の合計)、\\(O_{\\cdot \\cdot}\\)は全体の合計です。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#メガネの例",
    "href": "prezemi_2023_09_presen.html#メガネの例",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "メガネの例",
    "text": "メガネの例\n先のメガネの例で計算してみます。 観察度数\\(O\\)は次のようになります。\n\n\n\n\nメガネをかけている\nメガネをかけていない\n合計\n\n\n\n\n男\n41\n204\n245\n\n\n女\n81\n74\n155\n\n\n合計\n122\n278\n400\n\n\n\n男の行合計\\(O_{男\\cdot}\\)は245、女の行合計\\(O_{女\\cdot}\\)は155、メガネ有りの列合計\\(O_{\\cdot メガネ有}\\)は122、メガネなしの列合計\\(O_{\\cdot メガネ無}\\)は278、全体の合計\\(O_{\\cdot \\cdot}\\)は400となります。 ここから、期待度数は次のように計算されます。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#メガネの例-1",
    "href": "prezemi_2023_09_presen.html#メガネの例-1",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "メガネの例",
    "text": "メガネの例\n\\[\n\\begin{aligned}\nE_{男, メガネ} &= \\frac{245 \\times 122}{400} = 74.725 \\\\\nE_{男, メガネ無} &= \\frac{245 \\times 278}{400} = 170.275 \\\\\nE_{女, メガネ} &= \\frac{155 \\times 122}{400} = 47.275 \\\\\nE_{女, メガネ無} &= \\frac{155 \\times 278}{400} = 107.725\n\\end{aligned}\n\\]\nよって期待度数\\(E\\)は次のようになります。\n\n\n\n\nメガネをかけている\nメガネをかけていない\n合計\n\n\n\n\n男\n74.725\n170.275\n245\n\n\n女\n47.275\n107.725\n155\n\n\n合計\n122\n278\n400"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#メガネの例-2",
    "href": "prezemi_2023_09_presen.html#メガネの例-2",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "メガネの例",
    "text": "メガネの例\nここから、定義通りに、\\(\\chi^2\\)統計量を計算します。\n\\[\n\\begin{aligned}\n\\chi^2 = \\frac{(41 - 74.725)^2}{74.725} + \\frac{(204 - 170.275)^2}{170.275} + \\frac{(81 - 47.275)^2}{47.275} + \\frac{(74 - 107.725)^2}{107.725} = 7.2\n\\end{aligned}\n\\]\nここで計算した\\(\\chi^2\\)統計量は、自由度1の\\(\\chi^2\\)分布に従うということが知られています。この自由度は、カテゴリー変数のカテゴリー数から1を引いたものです。 ここでは、2カテゴリー同士のクロス集計表なので、自由度は\\((2-1) \\times (2-1) = 1\\)となります。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗分布の確率密度関数",
    "href": "prezemi_2023_09_presen.html#カイ二乗分布の確率密度関数",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗分布の確率密度関数",
    "text": "カイ二乗分布の確率密度関数\n自由度1のカイ二乗分布の確率密度関数は次のようになります。\n\n\nRコード\nx = c(1:2500) / 250 # 数列を作成\ny1 = dchisq(x,1) # カイ二乗分布の確率密度\n\ndf &lt;- data.frame(x, y1) # データフレームを作成\np &lt;- ggplot(df) + aes(x = x,y = y1) # 作図\np &lt;- p + geom_line(size = 1) # 折れ線グラフ\np &lt;- p + ylim(c(0,1)) + ylab(\"密度\") + xlab(\"カイ二乗値\") +\n  scale_y_continuous(expand = c(0,0), limits = c(0,1)) +\n  scale_x_continuous(expand = c(0,0), limits = c(-0.1,10))\np &lt;- p + ggtitle(\"自由度1のχ2分布の確率密度\")\nprint(p)"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗分布の形状",
    "href": "prezemi_2023_09_presen.html#カイ二乗分布の形状",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗分布の形状",
    "text": "カイ二乗分布の形状\n自由度が変わると\\(\\chi^2\\)分布の形状は変わる。\n\n\nRコード\nx = c(1:2500) / 250\ny1 = dchisq(x,1) # 自由度1のカイ二乗分布の確率密度\ny3 = dchisq(x,3) # 自由度3のカイ二乗分布の確率密度\ny5 = dchisq(x,5) # 自由度5のカイ二乗分布の確率密度\n\ndf &lt;- data.frame(x, y1, y3, y5) # データフレームを作成\ndf &lt;- df %&gt;%\n  pivot_longer(names_to = \"y\",values_to = \"value\",cols = -x) # データを長く整形\np &lt;- ggplot(df) + aes(x = x,y = value, group = y, color = y) # 作図\np &lt;- p + geom_line(size = 1) # 折れ線グラフ\np &lt;- p + ylim(c(0,1)) + ylab(\"密度\") + xlab(\"カイ二乗値\") +\n  scale_y_continuous(expand = c(0,0), limits = c(0,1)) +\n  scale_x_continuous(expand = c(0,0), limits = c(-0.1,10))\np &lt;- p + ggtitle(\"自由度1,3,5のχ2分布の確率密度\")\nprint(p)\n\n\n\n自由度1の\\(\\chi^2\\)分布における有意水準5%の値を調べるにはqchisq()関数を使う。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗分布",
    "href": "prezemi_2023_09_presen.html#カイ二乗分布",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗分布",
    "text": "カイ二乗分布\n\nalpha &lt;- 0.05  # 有意水準（ここでは5%）\ndf &lt;- 1        # 自由度\nqchisq(1 - alpha, df)\n\n[1] 3.841459\n\n\n自由度1のカイ二乗分布における有意水準5%の値は3.84であることが分かりました。 この値を超えると、有意水準5%で帰無仮説を棄却することになります。\nでは先程計算した\\(\\chi^2\\)統計量は、有意水準5%で帰無仮説を棄却するかどうかを調べてみましょう。\n\nchi2 &lt;- 7.2\nqchisq(1 - alpha, df) &lt; chi2\n\n[1] TRUE"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#量的変数間の関係",
    "href": "prezemi_2023_09_presen.html#量的変数間の関係",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "量的変数間の関係",
    "text": "量的変数間の関係\n2つの量的変数(連続変数)が同時に変化する関係を相関関係(correlation)といいます。 相関関係には、\n\n正の相関(positive correlation)\n負の相関(negative correlation)\n無相関(no correlation)\n\nの3種類があります。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#相関係数の分析",
    "href": "prezemi_2023_09_presen.html#相関係数の分析",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "相関係数の分析",
    "text": "相関係数の分析\n母平均\\(0\\)、母標準偏差\\(1\\)，サイズ10000の正規分布にしたがう変数\\(X\\)と\\(Y\\)\n\n\nRコード\nN &lt;- 10000 # 母集団のサイズ\nX &lt;- rnorm(N, 0, 1) # 平均0，標準偏差1の正規分布からN個\nY &lt;- rnorm(N, 0, 1) # 平均0，標準偏差1の正規分布からN個\nP &lt;- data.frame(X,Y) # データフレームを作成\nggplot(P) + aes(X,Y) + # グラフの下地\n  geom_point() + # 散布図\n  ggtitle(\"母集団\")  # タイトルとスタイル"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#シミュレーション",
    "href": "prezemi_2023_09_presen.html#シミュレーション",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "シミュレーション",
    "text": "シミュレーション\nこの母集団から標本サイズ100の標本を100個とりだし、相関係数を100個計算します。\n\nn &lt;- 100; trial &lt;- 100 # 標本サイズと試行回数\nsig &lt;- numeric(n) # 空の入れ物\ncor &lt;- numeric(n) # 空の入れ物\nfor(i in 1:trial){ # ループ\n  x_sample &lt;- sample(X, n) # 母集団からn個の標本を取り出す\n  y_sample &lt;- sample(Y, n) # 母集団からn個の標本を取り出す\n  res &lt;- cor.test(x_sample, y_sample) # 相関係数を計算\n  sig[i] &lt;- res$p.value # p値\n  cor[i] &lt;- cor(x_sample, y_sample) # 相関係数\n}\ndf_cor &lt;- data.frame(cor,sig) # p値と相関係数をデータフレームにまとめる\ndf_cor %&gt;% arrange(sig) %&gt;% head(2) # p値で並び替えて上位5つを表示\n\n         cor         sig\n1  0.2786349 0.004998387\n2 -0.2237441 0.025236613"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#散布図",
    "href": "prezemi_2023_09_presen.html#散布図",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "散布図",
    "text": "散布図\nたとえば、ある標本の散布図はこうなります。\n\n\nRコード\nx_sample &lt;- sample(X, n) # 母集団Xからn個の標本を取り出す\ny_sample &lt;- sample(Y, n) # 母集団Yからn個の標本を取り出す\ndata.frame(x_sample, y_sample) %&gt;% # データフレームにまとめる\n    ggplot() + aes(x_sample, y_sample) + # グラフの下地\n    geom_point() + # 散布図\n    geom_smooth(method = \"lm\", se = FALSE) + # 回帰直線\n    ggtitle(\"標本\")  # タイトルとスタイル\n\n\n\n微妙に右肩上がりの関係がありそうですが、ほぼ無相関といえるでしょう。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#相関係数の分布",
    "href": "prezemi_2023_09_presen.html#相関係数の分布",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "相関係数の分布",
    "text": "相関係数の分布\nでは、100個の標本から計算した100個の相関係数の大きさを並べてみましょう。 変数を並び替えるには，dplyrのarrange()関数を使います。 デフォルトでは昇順に並び替えられますが，arrange(desc())とすることで降順に並び替えることができます。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#相関係数の分布-1",
    "href": "prezemi_2023_09_presen.html#相関係数の分布-1",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "相関係数の分布",
    "text": "相関係数の分布\n\n\n\n\nRコード\nggplot(data.frame(df_cor)) +\n    aes(x = reorder(seq_along(cor), cor), y = cor) +\n    geom_bar(stat = \"identity\", fill = ifelse(sig &lt; 0.05, \"red\", \"black\")) +\n    ylab(\"相関係数\") + xlab(\"標本ID\") + ggtitle(\"相関係数の分布\")"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#仮説検定",
    "href": "prezemi_2023_09_presen.html#仮説検定",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "仮説検定",
    "text": "仮説検定\nでは、それらの値が、母集団では相関係数が\\(0\\)であるという帰無仮説が正しいとした場合に、どのくらいの確率で得られるのかを調べてみましょう。\n\n\nRコード\nggplot(data.frame(df_cor)) +\n    aes(x = reorder(seq_along(sig), sig), y=sig) + # データの指定\n    geom_bar(stat=\"identity\", fill = ifelse(sig &lt; 0.05, \"red\", \"black\")) + # 棒グラフ\n    ylab(\"p値\") + xlab(\"標本ID\") + ggtitle(\"相関係数のp値の分布\")  # 軸ラベルとタイトル"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#解釈",
    "href": "prezemi_2023_09_presen.html#解釈",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "解釈",
    "text": "解釈\n相関係数が0である母集団から標本を抜き出して、その標本相関係数の値が0.28となる確率\\(p\\)値は0.005となりました。 もし自分がもっている広告費と売上高のデータから相関係数を計算し、その値が0.28であったなら、母集団では相関係数が\\(0\\)であるという帰無仮説の下では、ほとんど起こりえないことが起こったということになります。 この場合、帰無仮説が間違っていて、対立仮説である広告費と売上高には関係があるという仮説のほうがもっともらしい、ということになります。 逆に、帰無仮説を棄却できなかった場合、広告費と売上高の間に関係は無いと主張することはできません。 帰無仮説が棄却できなかった場合は、関係があるかどうかはわからないということになります。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#因果関係",
    "href": "prezemi_2023_09_presen.html#因果関係",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "因果関係",
    "text": "因果関係\n可能性1：広告費が売上高に影響を与えている、という関係を想定しています。\n\ngraph LR\n    A[広告費] --&gt; B[売上高]\n\n\n\ngraph LR\n    A[広告費] --&gt; B[売上高]"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#因果関係-1",
    "href": "prezemi_2023_09_presen.html#因果関係-1",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "因果関係",
    "text": "因果関係\n可能性2：売上高が広告費に影響を与えている、という関係を想定しています。\n\ngraph RL\n    B[売上高] --&gt; A[広告費]\n\n\n\ngraph RL\n    B[売上高] --&gt; A[広告費]"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#互恵関係",
    "href": "prezemi_2023_09_presen.html#互恵関係",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "互恵関係",
    "text": "互恵関係\n可能性3 : 可能性1と可能性2が同時に起こっている、という関係を想定しています。\n\ngraph LR\n    A[広告費] --&gt; B[売上高]\n    B[売上高] --&gt; A[広告費]\n\n\n\ngraph LR\n    A[広告費] --&gt; B[売上高]\n    B[売上高] --&gt; A[広告費]"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#見せかけの相関",
    "href": "prezemi_2023_09_presen.html#見せかけの相関",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "見せかけの相関",
    "text": "見せかけの相関\n広告費と売上高の両方に影響を与える第3の要因が存在する場合、広告費と売上高の間に相関関係があるように見える、という想定です。 \n\ngraph TB\n    A[内部資金] --&gt; B[広告費]\n    A[内部資金] --&gt; C[売上高]\n\n\n\ngraph TB\n    A[内部資金] --&gt; B[広告費]\n    A[内部資金] --&gt; C[売上高]\n\n\n\n\n\n\ngraph TB\n    A[内部資金] --&gt; B[広告費]\n    A --&gt; C[売上高]\n    B -.-&gt; C\n\n\n\ngraph TB\n    A[内部資金] --&gt; B[広告費]\n    A --&gt; C[売上高]\n    B -.-&gt; C"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#確認方法",
    "href": "prezemi_2023_09_presen.html#確認方法",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "確認方法",
    "text": "確認方法\nまずは，2つの量的変数を使って散布図(scatter diagram)を描いて，目で見て相関関係があるかどうかを判断します。 そして，相関係数(correlation coefficient)を計算して，数値的に相関関係があるかどうかを判断します。 相関係数は次のように計算されます。\n\\[\nr = \\frac{\\sum_{i=1}^n (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^n (x_i - \\bar{x})^2}\\sqrt{\\sum_{i=1}^n (y_i - \\bar{y})^2}}\n\\]\n分子は、\\(x\\)と\\(y\\)の共分散(covariance)で、分母は\\(x\\)の標準偏差と\\(y\\)の標準偏差の積です。 相関係数\\(r\\)は\\(-1\\)から\\(1\\)の値をとります。 \\(r\\)が\\(1\\)に近いほど正の相関が強く、\\(-1\\)に近いほど負の相関が強く、\\(0\\)に近いほど無相関になります。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗検定の結果",
    "href": "prezemi_2023_09_presen.html#カイ二乗検定の結果",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗検定の結果",
    "text": "カイ二乗検定の結果\nより、\\(\\chi^2\\)統計量は有意水準5%で帰無仮説を棄却することが分かりました。 ちなみに、自由度1のカイ二乗分布の確率密度関数と\\(\\chi^2\\)統計量の位置を重ねてみると次のようになります。\n\n\nRコード\ndf &lt;- data.frame(x,y1)\np &lt;- ggplot(df) + aes(x = x,y = y1)\np &lt;- p + geom_line(size = 1)\np &lt;- p + ylim(c(0,1)) + ylab(\"密度\") + xlab(\"カイ二乗値\") +\n  scale_y_continuous(expand = c(0,0), limits = c(0,1)) +\n  scale_x_continuous(expand = c(0,0), limits = c(-0.1,10))\np &lt;- p + ggtitle(\"自由度1のχ2分布の確率密度\")\np &lt;- p + geom_vline(xintercept = chi2, linetype = \"dashed\", color = \"red\")\np &lt;- p + annotate(\"text\", x = chi2, y = 0.1, label = \"χ2 statistics\", color = \"red\")\nprint(p)"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗検定の結果-1",
    "href": "prezemi_2023_09_presen.html#カイ二乗検定の結果-1",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗検定の結果",
    "text": "カイ二乗検定の結果\nこのように、\\(\\chi^2\\)統計量は、自由度1のカイ二乗分布のもとで生じる確率は、\n\n1 - pchisq(chi2, df = 1)\n\n[1] 0.007290358\n\n\nとなり、非常に小さな値であることが分かりました。 つまり、2つのカテゴリー変数の間に関係がない、という帰無仮説の下で、観測された度数が発生することはほぼありえない、ということが言えるので、帰無仮説は棄却され、2つのカテゴリー変数には関係があると結論付けられます。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#rでχ2検定",
    "href": "prezemi_2023_09_presen.html#rでχ2検定",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "Rでχ2検定",
    "text": "Rでχ2検定\nchisq.test()関数を使ってχ2検定を行う。 引数は、xに度数表、correctに補正を行うかどうか、pに期待度数を指定する。 matrix()関数を使ってクロス集計表を行列として作成する。\n\n\nRコード\nO &lt;- matrix(c(41, 81, 204, 74), nrow = 2, ncol = 2)\nrow.names(O) &lt;- c(\"男性\", \"女性\")\ncolnames(O) &lt;- c(\"メガネ\", \"メガネなし\")\n\nE &lt;- matrix(c(\n  sum(O[,1])*sum(O[1,])/sum(O), #男眼鏡\n  sum(O[,1])*sum(O[2,])/sum(O), #男眼鏡無\n  sum(O[,2])*sum(O[1,])/sum(O), #女眼鏡\n  sum(O[,2])*sum(O[2,])/sum(O)  #女眼鏡無\n), nrow = 2, ncol = 2)\n\nprint(O)\n\n\n     メガネ メガネなし\n男性     41        204\n女性     81         74\n\n\nRコード\nprint(E)\n\n\n       [,1]    [,2]\n[1,] 74.725 170.275\n[2,] 47.275 107.725"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#rでχ2検定-1",
    "href": "prezemi_2023_09_presen.html#rでχ2検定-1",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "Rでχ2検定",
    "text": "Rでχ2検定\nこの観察度数と期待度数から、定義通りに\\(\\chi^2\\)統計量を計算してみます。\n\nchi &lt;-  (O[1,1] - E[1,1])^2 / E[1,1] + #男眼鏡\n        (O[1,2] - E[1,2])^2 / E[1,2] + #男眼鏡無\n        (O[2,1] - E[2,1])^2 / E[2,1] + #女眼鏡\n        (O[2,2] - E[2,2])^2 / E[2,2]   #女眼鏡無\nprint(chi)\n\n[1] 56.51731\n\n\n\\(\\chi^2\\)統計量がとなりました。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#rでχ2検定-2",
    "href": "prezemi_2023_09_presen.html#rでχ2検定-2",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "Rでχ2検定",
    "text": "Rでχ2検定\nこの\\(\\chi^2\\)統計量が自由度1の\\(\\chi^2\\)分布にしたがう場合，この統計量が得られる確率は次のようになります。\n\nprop &lt;- 1 - pchisq(chi, df = 1)\nprint(prop)\n\n[1] 5.57332e-14\n\n\nこの確率は0.0000000000000055733となり，ほぼゼロであることが分かりました。 よって、2つのカテゴリー変数は無関係である，という帰無仮説は棄却され、2つのカテゴリー変数には関係があると結論付けられます。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#rでχ2検定-3",
    "href": "prezemi_2023_09_presen.html#rでχ2検定-3",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "Rでχ2検定",
    "text": "Rでχ2検定\nちなみに，上記のようなめんどくさい処理をしなくても，Rにはchisq.test()という関数が用意されています。 chisq.test()は引数として、xに度数表、correctに補正を行うかどうか、pに期待度数を指定します。 補正は行わないので，correctはFALSEとします。 pはデフォルトで等確率となっているので，今回は省略します。\n\nchisq.test(O, correct = FALSE)\n\n\n    Pearson's Chi-squared test\n\ndata:  O\nX-squared = 56.517, df = 1, p-value = 5.571e-14\n\n\nとなり，先ほどの結果と一致しました。"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#フィッシャーの直接確率検定",
    "href": "prezemi_2023_09_presen.html#フィッシャーの直接確率検定",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "フィッシャーの直接確率検定",
    "text": "フィッシャーの直接確率検定\n各マスに入る度数が少ない場合には、フィッシャーの直接確率検定を使います。\n\nfisher.test(O)\n\n\n    Fisher's Exact Test for Count Data\n\ndata:  O\np-value = 1.204e-13\nalternative hypothesis: true odds ratio is not equal to 1\n95 percent confidence interval:\n 0.1127341 0.2982245\nsample estimates:\nodds ratio \n 0.1845096"
  },
  {
    "objectID": "prezemi_2023_09_presen.html#カイ二乗分布補足",
    "href": "prezemi_2023_09_presen.html#カイ二乗分布補足",
    "title": "プレゼミ2023  第9回 変数間の関連性",
    "section": "カイ二乗分布(補足)",
    "text": "カイ二乗分布(補足)\nカイ二乗分布は、確率変数\\(Z_1, Z_2,\\dots, Z_k\\)が互いに独立であり、それぞれが標準正規分布\\(N(0,1)\\)に従うとき、その二乗和が従う分布を自由度\\(k\\)のカイ二乗分布といいます。\n\\[\n\\chi^2 = Z_1^2 + Z_2^2 + \\dots + Z_k^2\n\\]\n導出は省きますが、自由度\\(k\\)のカイ二乗分布の密度関数は、\n\\[\n\\begin{aligned}\nf(x) =\n\\begin{cases}\n\\frac{1}{2^{k/2} \\Gamma(k/2)} x^{k/2 - 1} \\mathrm{e}^{-x/2} & (x \\geq 0)\\\\\n0 & (x &lt; 0)\n\\end{cases}\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#準備",
    "href": "prezemi_2023_10_presen.html#準備",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "準備",
    "text": "準備\n必要なパッケージと設定。無ければインストールする。\n\nknitr::opts_chunk$set(dev = \"ragg_png\")\nlibrary(tidyverse) # とりあえずこれ\nlibrary(ggthemes) # ggplot2のテーマ\nlibrary(knitr) # 作表\nlibrary(kableExtra) # 作表の拡張\nlibrary(scales) # 軸の単位を制御\nlibrary(modelsummary) # モデルのまとめ\ntheme_set(theme_few(base_size = 12))\nupdate_geom_defaults(\"point\", list(size = 3))"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#データの読み込み",
    "href": "prezemi_2023_10_presen.html#データの読み込み",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "データの読み込み",
    "text": "データの読み込み\n松浦のウェブサイトからデータadv_2023.csvを読み込む。\n\ndf &lt;- read_csv(\"https://so-ichi.com/adv_2023.csv\")\nrmarkdown::paged_table(df, options = list(rows.print = 5, cols.print = 3))"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデル",
    "href": "prezemi_2023_10_presen.html#単回帰モデル",
    "title": "プレゼミ2023  第10回 単回帰分析",
    "section": "単回帰モデル",
    "text": "単回帰モデル\n前回は売上高と広告宣伝費の関係を散布図(scatter diagram)と相関係数(correlation)を使って調べた。\n\n相関係数は0.424"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#変数間の関係",
    "href": "prezemi_2023_10_presen.html#変数間の関係",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "2変数間の関係",
    "text": "2変数間の関係\n前回は売上高と広告宣伝費の関係を散布図(scatter diagram)と相関係数(correlation)を使って調べた。\n\n相関係数はNAと正の相関がある。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデル-1",
    "href": "prezemi_2023_10_presen.html#単回帰モデル-1",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "単回帰モデル",
    "text": "単回帰モデル\n\n回帰モデル(regression model)とは、応答変数\\(Y\\)を説明変数\\(X\\)の線形関数で表したモデルで、背後には\\(X \\rightarrow Y\\)という因果関係(causality)があると仮定する。\n相関係数は2変数間の線形関係を表す指標ではあるが、相関があるからといって因果関係(causality)があるとは限らない。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデル-2",
    "href": "prezemi_2023_10_presen.html#単回帰モデル-2",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "単回帰モデル",
    "text": "単回帰モデル\n売上高を広告宣伝費で説明するモデルを考える。\n\ngraph LR\nA[広告宣伝費] --&gt; B[売上高]\n\n\n\ngraph LR\nA[広告宣伝費] --&gt; B[売上高]\n\n\n\n\n\nこの因果関係を明らかにするため、売上高を応答変数\\(Y\\)、広告宣伝費を説明変数\\(X\\)として回帰モデルを構築する。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#重回帰分析による統計的推定",
    "href": "prezemi_2023_10_presen.html#重回帰分析による統計的推定",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "重回帰分析による統計的推定",
    "text": "重回帰分析による統計的推定\n重回帰モデル\n重回帰でも単回帰でも統計的推定に変わりはありません。 重回帰モデルを以下のように表します。\n\\[\nY_i = \\beta _0 + \\beta_1 x_{i1} + \\beta_2 x_{i2} + \\cdots + \\beta_p x_{ik} + \\varepsilon_i\n\\]\nこの回帰係数\\(\\beta\\)の推定値\\(b\\)を求めることが統計的推定です。\n企業の売上高は、前年度の広告宣伝費と研究開発費で説明できる、つまり前年度の広告宣伝費と研究開発費が高いほど、売上高が高くなるのかどうかを考えてみます。\n\\[\n\\text{売上高}_t = \\beta_0 + \\beta_1 \\text{広告宣伝費}_{t-1} + \\beta_2 \\text{研究開発費}_{t-1} + \\varepsilon_t\n\\]\nではこの回帰モデルを推定するためのデータを読み込むため、tidyverseのreadrパッケージのread_csv()関数を使って、作業ディレクトリのdataフォルダの中に保存されているadv_2023.csvを読み込みます。\n\ndf &lt;- read_csv(\"data/adv_2023.csv\")\n\n重回帰モデルを推定するには、基本関数のlm()を使います。 重回帰モデルの場合、複数の説明変数があるため+でつなげていきます。\n\nres &lt;- lm(売上高 ~ lag(研究開発費) + lag(広告宣伝費), data = df)\ncoef(res)\n\n    (Intercept) lag(研究開発費) lag(広告宣伝費) \n   1.004955e+05    1.716521e+01    6.913074e+00 \n\n\n上記の推定結果から、\n\\[\n\\text{売上高} = 0.00000 + 0.1716 \\text{研究開発費}_{t-1} + 6.8131 \\text{広告宣伝費}_{t-1}\n\\] であることが分かりました。\n信頼区間と仮説検定\n先ほどの回帰係数の推定結果は，1サンプルからの結果であり，サンプルの数を増やせば推定値の分布ができるのは，単回帰分析と同じなので， ここでも同じ方法で信頼区間を求めることが出来ます。 単回帰分析の場合，切片と回帰係数の2つが推定するパラメータなので，自由度が\\(n-2\\)の\\(t\\)分布を利用しました。 説明変数が\\(k\\)個ある重回帰分析の推定で利用する\\(t\\)分布の自由度は，\\(n-k-1\\)になります。 \\(100(1-\\alpha)\\)％信頼区間は，\n\\[\nb_m - t _{n-k-1, \\frac{\\alpha}{2}} SE(b_m) \\leq \\beta_m \\leq b_m + t_{n-k-1, \\frac{\\alpha}{2}} SE(b_m)\n\\]\nのように計算できます。 先ほど推定した重回帰分析の結果を再度確認してみます。\n\nsummary(res)\n\n\nCall:\nlm(formula = 売上高 ~ lag(研究開発費) + lag(広告宣伝費), \n    data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-12323473   -100139    -69328     20239  19099811 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     1.005e+05  1.257e+04   7.995 1.58e-15 ***\nlag(研究開発費) 1.717e+01  2.639e-01  65.039  &lt; 2e-16 ***\nlag(広告宣伝費) 6.913e+00  5.164e-01  13.386  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 862200 on 5171 degrees of freedom\n  ( 23266 個の観測値が欠損のため削除されました )\nMultiple R-squared:  0.7853,    Adjusted R-squared:  0.7853 \nF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16\n\n\nここから信頼区間を計算するためには，サンプルサイズ\\(n\\)と説明変数の数\\(k\\)から自由度\\(df = n - k -1\\)を求め， そのもとで特定の有意水準を設定して，関数qt()を使って\\(t\\)値を計算します。 先ほどの重回帰の例だと，サンプルサイズは28440，説明変数の数は2なので，有意水準5％の両側検定を行う場合の\\(t\\)値は，\n\nn &lt;- nrow(df) # サンプルサイズ\nk &lt;- 2 # 説明変数の数\nfreedom &lt;- n - 2 - 1\np &lt;- 0.025 # 両側5%なので片側2.5％\nqt(p, freedom , lower.tail = F)\n\n[1] 1.960047\n\n\nすると\\(t\\)値は，1.96と計算できました。\n仮説検定\n重回帰分析で検証したい仮説は，説明変数が応答変数に影響を与えるか否かですが，複数の説明変数があるため，仮説には2つのパターンがあります。 1つ目は，回帰係数のすべてがゼロである，という帰無仮説です。 構築した回帰モデルの説明変数の中に，応答変数に影響を与えるものが1つもない，という仮説です。 \\[\n\\begin{aligned}\nH_0 : &\\beta _1 = \\beta _2 = \\cdots = \\beta_k = 0\\\\\nH_A : &\\beta _1 \\not = 0 \\text{ or } \\beta _2 \\not = 0 \\text{ or } \\cdots \\text{ or } \\beta _k \\not = 0\n\\end{aligned}\n\\]\n2つ目は，回帰係数の中に少なくとも1つはゼロではない，という仮説です。 この仮説だと，個々の説明変数が応答変数に与える影響を別々に考え，説明変数ごとに回帰係数がゼロとなるかどうかを調べることになります。\n\\[\n\\begin{aligned}\nH_{01}: \\beta _1 &= 0, & H_{a1} : \\beta _1 \\not = 0 \\\\\nH_{02}: \\beta _1 &= 0, & H_{a2} : \\beta _1 \\not = 0 \\\\\n\\vdots \\\\\nH_{0k}: \\beta _k &= 0, & H_{ak} : \\beta _k \\not = 0 \\\\\n\\end{aligned}\n\\]\n1つの仮説の検定\nすべての回帰係数がゼロかどうかを検定するためには，F分布という確率分布を用います。 F分布の確率密度関数の導出は難しいのでここでは省略します F分布の下で，自由度\\(n - k -1\\)で説明変数の数が\\(k\\)個であるときの検定統計量\\(F_0\\)は，次のように計算できます。\n\\[\n\\begin{aligned}\nF_0 = \\frac{R^2}{1 - R^2} \\frac{n - k - 1}{k} = \\displaystyle \\frac{\\sum (\\hat y - \\bar y)^2}{k} \\div \\frac{\\sum e_i-2}{n - k - 1}\n\\end{aligned}\n\\]\nここで\\(R^2\\)は決定係数です。 この検定統計量\\(F_0\\)を用いたF検定の結果は，lm()関数で推定した結果のsummary()関数で確認できます。\n\nsummary(res)\n\n\nCall:\nlm(formula = 売上高 ~ lag(研究開発費) + lag(広告宣伝費), \n    data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-12323473   -100139    -69328     20239  19099811 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     1.005e+05  1.257e+04   7.995 1.58e-15 ***\nlag(研究開発費) 1.717e+01  2.639e-01  65.039  &lt; 2e-16 ***\nlag(広告宣伝費) 6.913e+00  5.164e-01  13.386  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 862200 on 5171 degrees of freedom\n  ( 23266 個の観測値が欠損のため削除されました )\nMultiple R-squared:  0.7853,    Adjusted R-squared:  0.7853 \nF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16\n\n\n結果の最後の行でF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16とあり，自由度2と5171のF分布で検定した結果，検定統計量\\(F_0\\)は9460であり，p値はほぼゼロとなりました。 つまり，帰無仮説である「すべての回帰係数がゼロ」は棄却され，少なくとも一つの回帰係数はゼロではない，という対立仮説が採択されました。\nt分布と同様にF分布を用いた検定の臨界値は基本関数qf()で計算できます。 先ほどの例だと，サンプルサイズは28440，説明変数の数は2なので，有意水準5％の両側検定を行う場合の\\(t\\)値は，\n\np = 0.05\nf1 &lt;- 2\nf2 &lt;- 5171\nqf(p,f1,f2,lower.tail =F)\n\n[1] 2.997468\n\n\nとなり，2.9975という臨界値が得られた。 先ほどの推定結果からF値が9460と，臨界値を遙かに超える値であったため，帰無仮説は棄却された。\n回帰係数の個別的検定\n第2の仮説のパターンである個々の回帰係数の検定について考えてみましょう。 売上高を研究開発費と広告宣伝費で説明しようとした重回帰モデルだと，次の2つの仮説を検定することになります。\n\\[\n\\begin{aligned}\n\\text{研究開発費} H_{01} : \\beta_1 = 0, & H_{a1} : \\beta_1 \\not = 0 \\\\\n\\text{広告宣伝費} H_{02} : \\beta_1 = 0, & H_{a2} : \\beta_1 \\not = 0\n\\end{aligned}\n\\]\n回帰係数の個別的検定は，単回帰分析と同様にt検定を用います。 この分析結果も，summary()関数で確認できます。\n\nsummary(res)\n\n\nCall:\nlm(formula = 売上高 ~ lag(研究開発費) + lag(広告宣伝費), \n    data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-12323473   -100139    -69328     20239  19099811 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     1.005e+05  1.257e+04   7.995 1.58e-15 ***\nlag(研究開発費) 1.717e+01  2.639e-01  65.039  &lt; 2e-16 ***\nlag(広告宣伝費) 6.913e+00  5.164e-01  13.386  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 862200 on 5171 degrees of freedom\n  ( 23266 個の観測値が欠損のため削除されました )\nMultiple R-squared:  0.7853,    Adjusted R-squared:  0.7853 \nF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16\n\n\nCoefficientsの出力結果に，各説明変数の回帰係数の推定値Estimateと標準誤差Std. Error，t値t value，p値Pr(&gt;|t|)が表示されています。 このp値が設定した有意水準より小さい場合，その回帰係数がゼロであるという帰無仮説が棄却され，説明変数が応答変数に影響を与えている，という対立仮説が採択されるのです。\nこのように複数の説明変数で応答変数を説明しようとする重回帰分析だと，2種類の仮説検証を行うことになります。 気をつける点として，すべての回帰係数がゼロであるという帰無仮説を検証するF検定で，帰無仮説が棄却されたとしても，個別の回帰係数の検定で，すべての検定で帰無仮説を棄却できない，というケースも起こり得ます。 このような結果が出たときは，説明変数どうしの相関が強いときに生じやすいので注意しよう。\n重回帰分析の結果を論文などに掲載する場合には，ほぼ決まったフォーマットがあるため，それに従って結果をまとめることになります。 例えば，次のような表を作成することになります。\n\nlibrary(modelsummary)\nmsummary(res,\n  stars = TRUE, # p値の有意性を星で表示する\n  fmt = '%.2f',\n  gof_omit = \"AIC|BIC|Log.Lik.\",\n  output = 'html'\n)\n\n\n\n\n\n (1)\n\n\n\n\n(Intercept)\n100495.49***\n\n\n\n(12569.41)\n\n\nlag(研究開発費)\n17.17***\n\n\n\n(0.26)\n\n\nlag(広告宣伝費)\n6.91***\n\n\n\n(0.52)\n\n\nNum.Obs.\n5174\n\n\nR2\n0.785\n\n\nR2 Adj.\n0.785\n\n\nRMSE\n861991.65\n\n\n\n + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#まとめ",
    "href": "prezemi_2023_10_presen.html#まとめ",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "まとめ",
    "text": "まとめ\n\n観測値とモデルとの差を表す確率変数である誤差項を含んだ確率的回帰モデルを考える。\n誤差項は平均ゼロの正規分布にしたがう確率変数であると仮定\n回帰分析の目的は係数\\(\\beta_m\\)の推定値\\(b_m\\)の値を求めること\n推定値\\(b_m\\)は標本ごとに異なる値で分布する。推定値の信頼区間を求めて推定の不確実性を評価\n重回帰モデルの仮説検定は2種類:すべての回帰係数がゼロであると個々の回帰係数がゼロである、がある。前者にはF検定，後者にはt検定を用いる。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデル-3",
    "href": "prezemi_2023_10_presen.html#単回帰モデル-3",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "単回帰モデル",
    "text": "単回帰モデル\nここでは次のような線形モデルを構築する。\n\\[\nY_i = \\beta _0 + \\beta_1 X_i\n\\]\n\n\\(\\beta_0\\)と\\(\\beta_1\\)はパラメータ(定数)\nこのモデルにしたがうと，\\(X_i\\)の値が決まれば、応答変数\\(Y\\)の値は一意に決まる。\nこのようなモデルを決定的モデル(deterministic model)"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデル-4",
    "href": "prezemi_2023_10_presen.html#単回帰モデル-4",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "単回帰モデル",
    "text": "単回帰モデル\n現実には、広告宣伝費が同じでも売上高が異なることがある。 そこで売上高の水準が広告宣伝費だけで決まるのではなく、誤差\\(\\varepsilon\\)を回帰モデルに加えたものを考える。\n\\[\nY_i = \\beta _0 + \\beta_1 X_i + \\varepsilon_i\n\\]\n\n\n確率変数である誤差項を含めたモデルを確率モデル(probabilistic model)という。\nここでは\\(\\varepsilon_i\\)が正規分布に従うと仮定する。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデルの図",
    "href": "prezemi_2023_10_presen.html#単回帰モデルの図",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "単回帰モデルの図",
    "text": "単回帰モデルの図"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデルの過程",
    "href": "prezemi_2023_10_presen.html#単回帰モデルの過程",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "単回帰モデルの過程",
    "text": "単回帰モデルの過程\nこの回帰モデルが意味をもつためには、誤差項\\(\\varepsilon_i\\)が平均0で分散\\(\\sigma^2\\)の正規分布に従うという仮定が必要です。\n\n図11.1信頼区間と仮説検定"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#単回帰モデルの仮定",
    "href": "prezemi_2023_10_presen.html#単回帰モデルの仮定",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "単回帰モデルの仮定",
    "text": "単回帰モデルの仮定\nこの回帰モデルが意味をもつためには、誤差項\\(\\varepsilon_i\\)が平均0で分散\\(\\sigma^2\\)の正規分布に従うという仮定が必要です。\n\n図11.1"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#重回帰モデル",
    "href": "prezemi_2023_10_presen.html#重回帰モデル",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "重回帰モデル",
    "text": "重回帰モデル\n重回帰でも単回帰でも統計的推定は同じで、説明変数が1つか複数かの違いだけである。\n\\[\nY_i = \\beta _0 + \\beta_1 x_{i1} + \\beta_2 x_{i2} + \\cdots + \\beta_p x_{ik} + \\varepsilon_i\n\\]\nこの回帰係数\\(\\beta\\)の推定値\\(b\\)を求めることが統計的推定となる。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#重回帰モデル-1",
    "href": "prezemi_2023_10_presen.html#重回帰モデル-1",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "重回帰モデル",
    "text": "重回帰モデル\n企業の売上高は、前年度の広告宣伝費と研究開発費で説明できる、というモデルを考える。\n\\[\n\\text{売上高}_t = \\beta_0 + \\beta_1 \\text{広告宣伝費}_{t-1} + \\beta_2 \\text{研究開発費}_{t-1} + \\varepsilon_t\n\\]"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#重回帰モデルの推定",
    "href": "prezemi_2023_10_presen.html#重回帰モデルの推定",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "重回帰モデルの推定",
    "text": "重回帰モデルの推定\n\n重回帰モデルを推定するには、基本関数のlm()を使う。\n重回帰モデルの場合、複数の説明変数があるため+でつなげる\n\n\nres &lt;- lm(売上高 ~ lag(研究開発費) + lag(広告宣伝費), data = df)\ncoef(res)\n\n    (Intercept) lag(研究開発費) lag(広告宣伝費) \n   1.004955e+05    1.716521e+01    6.913074e+00"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#結果の解釈",
    "href": "prezemi_2023_10_presen.html#結果の解釈",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "結果の解釈",
    "text": "結果の解釈\n上記の推定結果から、\n\\[\n\\text{売上高} = 0.00000 + 0.1716 \\text{研究開発費}_{t-1} + 6.8131 \\text{広告宣伝費}_{t-1}\n\\]\nであることが分かった。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#結果の解釈-1",
    "href": "prezemi_2023_10_presen.html#結果の解釈-1",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "結果の解釈",
    "text": "結果の解釈\n先ほど推定した重回帰分析の結果を再度確認してみます。\n\nsummary(res)\n\n\nCall:\nlm(formula = 売上高 ~ lag(研究開発費) + lag(広告宣伝費), \n    data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-12323473   -100139    -69328     20239  19099811 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     1.005e+05  1.257e+04   7.995 1.58e-15 ***\nlag(研究開発費) 1.717e+01  2.639e-01  65.039  &lt; 2e-16 ***\nlag(広告宣伝費) 6.913e+00  5.164e-01  13.386  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 862200 on 5171 degrees of freedom\n  ( 23266 個の観測値が欠損のため削除されました )\nMultiple R-squared:  0.7853,    Adjusted R-squared:  0.7853 \nF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#仮説検定",
    "href": "prezemi_2023_10_presen.html#仮説検定",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "仮説検定",
    "text": "仮説検定\n重回帰分析で検証したい仮説は，説明変数が応答変数に影響を与えるか否かですが，複数の説明変数があるため，仮説には2つのパターンがあります。 1つ目は，回帰係数のすべてがゼロである，という帰無仮説です。 構築した回帰モデルの説明変数の中に，応答変数に影響を与えるものが1つもない，という仮説です。 \\[\n\\begin{aligned}\nH_0 : &\\beta _1 = \\beta _2 = \\cdots = \\beta_k = 0\\\\\nH_A : &\\beta _1 \\not = 0 \\text{ or } \\beta _2 \\not = 0 \\text{ or } \\cdots \\text{ or } \\beta _k \\not = 0\n\\end{aligned}\n\\]\n2つ目は，回帰係数の中に少なくとも1つはゼロではない，という仮説です。 この仮説だと，個々の説明変数が応答変数に与える影響を別々に考え，説明変数ごとに回帰係数がゼロとなるかどうかを調べることになります。\n\\[\n\\begin{aligned}\nH_{01}: \\beta _1 &= 0, & H_{a1} : \\beta _1 \\not = 0 \\\\\nH_{02}: \\beta _1 &= 0, & H_{a2} : \\beta _1 \\not = 0 \\\\\n\\vdots \\\\\nH_{0k}: \\beta _k &= 0, & H_{ak} : \\beta _k \\not = 0 \\\\\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#つの仮説の検定",
    "href": "prezemi_2023_10_presen.html#つの仮説の検定",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "1つの仮説の検定",
    "text": "1つの仮説の検定\nすべての回帰係数がゼロかどうかを検定するためには，F分布という確率分布を用います。 F分布の確率密度関数の導出は難しいのでここでは省略します F分布の下で，自由度\\(n - k -1\\)で説明変数の数が\\(k\\)個であるときの検定統計量\\(F_0\\)は，次のように計算できます。\n\\[\n\\begin{aligned}\nF_0 = \\frac{R^2}{1 - R^2} \\frac{n - k - 1}{k} = \\displaystyle \\frac{\\sum (\\hat y - \\bar y)^2}{k} \\div \\frac{\\sum e_i-2}{n - k - 1}\n\\end{aligned}\n\\]\nここで\\(R^2\\)は決定係数です。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#信頼区間と仮説検定",
    "href": "prezemi_2023_10_presen.html#信頼区間と仮説検定",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "信頼区間と仮説検定",
    "text": "信頼区間と仮説検定\n\n単回帰分析の場合，切片と回帰係数の2つが推定するパラメータなので，自由度が\\(n-2\\)の\\(t\\)分布を利用しました。 説明変数が\\(k\\)個ある重回帰分析の推定で利用する\\(t\\)分布の自由度は，\\(n-k-1\\)になります。 \\(100(1-\\alpha)\\)％信頼区間は，\n\\[\nb_m - t _{n-k-1, \\frac{\\alpha}{2}} SE(b_m) \\leq \\beta_m \\leq b_m + t_{n-k-1, \\frac{\\alpha}{2}} SE(b_m)\n\\]\nのように計算できる。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#結果の解釈-2",
    "href": "prezemi_2023_10_presen.html#結果の解釈-2",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "結果の解釈",
    "text": "結果の解釈\nここから信頼区間を計算するためには，サンプルサイズ\\(n\\)と説明変数の数\\(k\\)から自由度\\(df = n - k -1\\)を求め，そのもとで特定の有意水準を設定して，関数qt()を使って\\(t\\)値を計算する。\n先ほどの重回帰の例だと，サンプルサイズは28440，説明変数の数は2なので，有意水準5％の両側検定を行う場合の\\(t\\)値は，\n\nn &lt;- nrow(df) # サンプルサイズ\nk &lt;- 2 # 説明変数の数\nfreedom &lt;- n - 2 - 1\np &lt;- 0.025 # 両側5%なので片側2.5％\nqt(p, freedom , lower.tail = F)\n\n[1] 1.960047\n\n\nすると\\(t\\)値は，1.96となる。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#仮説検定-1",
    "href": "prezemi_2023_10_presen.html#仮説検定-1",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "仮説検定 1",
    "text": "仮説検定 1\n重回帰分析で検証したい仮説は，説明変数が応答変数に影響を与えるか否かですが，複数の説明変数があるため，仮説には2つのパターンがあります。\n回帰係数のすべてがゼロである，という帰無仮説\n構築した回帰モデルの説明変数の中に，応答変数に影響を与えるものが1つもない，という仮説です。 \\[\n\\begin{aligned}\nH_0 : &\\beta _1 = \\beta _2 = \\cdots = \\beta_k = 0\\\\\nH_A : &\\beta _1 \\not = 0 \\text{ or } \\beta _2 \\not = 0 \\text{ or } \\cdots \\text{ or } \\beta _k \\not = 0\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#仮説検定-2",
    "href": "prezemi_2023_10_presen.html#仮説検定-2",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "仮説検定 2",
    "text": "仮説検定 2\n2つ目は，回帰係数の中に少なくとも1つはゼロではない，という帰無仮説である。\nこの仮説だと，個々の説明変数が応答変数に与える影響を別々に考え，説明変数ごとに回帰係数がゼロとなるかどうかを調べる。\n\\[\n\\begin{aligned}\nH_{01}: \\beta _1 &= 0, & H_{a1} : \\beta _1 \\not = 0 \\\\\nH_{02}: \\beta _1 &= 0, & H_{a2} : \\beta _1 \\not = 0 \\\\\n\\vdots \\\\\nH_{0k}: \\beta _k &= 0, & H_{ak} : \\beta _k \\not = 0 \\\\\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#回帰係数の個別的検定-1",
    "href": "prezemi_2023_10_presen.html#回帰係数の個別的検定-1",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "回帰係数の個別的検定",
    "text": "回帰係数の個別的検定\n回帰係数の個別的検定は，単回帰分析と同様にt検定を用いる。 分析結果をsummary()関数で確認する。\n\nsummary(res)\n\n\nCall:\nlm(formula = 売上高 ~ lag(研究開発費) + lag(広告宣伝費), \n    data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-12323473   -100139    -69328     20239  19099811 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     1.005e+05  1.257e+04   7.995 1.58e-15 ***\nlag(研究開発費) 1.717e+01  2.639e-01  65.039  &lt; 2e-16 ***\nlag(広告宣伝費) 6.913e+00  5.164e-01  13.386  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 862200 on 5171 degrees of freedom\n  ( 23266 個の観測値が欠損のため削除されました )\nMultiple R-squared:  0.7853,    Adjusted R-squared:  0.7853 \nF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#結果の見方",
    "href": "prezemi_2023_10_presen.html#結果の見方",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "結果の見方",
    "text": "結果の見方\n\nCoefficientsの出力結果に，各説明変数の回帰係数の推定値Estimateと標準誤差Std. Error，t値t value，p値Pr(&gt;|t|)が表示\np値が設定した有意水準より小さい場合，その回帰係数がゼロであるという帰無仮説が棄却され，説明変数が応答変数に影響を与えている，という対立仮説が採択\nすべての回帰係数がゼロであるという帰無仮説を検証するF検定で，帰無仮説が棄却されたとしても，個別の回帰係数の検定で，すべての検定で帰無仮説を棄却できない，というケースも起こりうる。\nこのような結果が出たときは，説明変数どうしの相関が強いときに生じやすいので注意"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#重回帰分析の結果のまとめ方",
    "href": "prezemi_2023_10_presen.html#重回帰分析の結果のまとめ方",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "重回帰分析の結果のまとめ方",
    "text": "重回帰分析の結果のまとめ方\n重回帰分析の結果を論文などに掲載する場合には，ほぼ決まったフォーマットがあるため，それに従って結果をまとめる。 ここでは超便利パッケージmodelsummaryを使う。\n\nlibrary(modelsummary)\nlibrary(gt)\nmsummary(res,\n  stars = TRUE, # p値の有意性を星で表示する\n  fmt = '%.2f', # 小数点以下2桁で表示\n  gof_omit = \"AIC|BIC|Log.Lik.\" # いらない統計量\n)"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#重回帰分析の結果のまとめ方-output",
    "href": "prezemi_2023_10_presen.html#重回帰分析の結果のまとめ方-output",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "重回帰分析の結果のまとめ方",
    "text": "重回帰分析の結果のまとめ方\n\n\n\n\n\n (1)\n\n\n\n\n(Intercept)\n100495.49***\n\n\n\n(12569.41)\n\n\nlag(研究開発費)\n17.17***\n\n\n\n(0.26)\n\n\nlag(広告宣伝費)\n6.91***\n\n\n\n(0.52)\n\n\nNum.Obs.\n5174\n\n\nR2\n0.785\n\n\nR2 Adj.\n0.785\n\n\nRMSE\n861991.65\n\n\n\n + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#回帰係数の個別的検定",
    "href": "prezemi_2023_10_presen.html#回帰係数の個別的検定",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "回帰係数の個別的検定",
    "text": "回帰係数の個別的検定\n第2の仮説のパターンである個々の回帰係数の検定について考えてみる。 売上高を研究開発費と広告宣伝費で説明しようとした重回帰モデルだと，次の2つの仮説を検定することになる。\n\\[\n\\begin{aligned}\n\\text{研究開発費} H_{01} : \\beta_1 = 0, & H_{a1} : \\beta_1 \\not = 0 \\\\\n\\text{広告宣伝費} H_{02} : \\beta_1 = 0, & H_{a2} : \\beta_1 \\not = 0\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#つの仮説の検定-1",
    "href": "prezemi_2023_10_presen.html#つの仮説の検定-1",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "1つの仮説の検定",
    "text": "1つの仮説の検定\nこの検定統計量\\(F_0\\)を用いたF検定の結果は，lm()関数で推定した結果のsummary()関数で確認できます。\n\nsummary(res)\n\n\nCall:\nlm(formula = 売上高 ~ lag(研究開発費) + lag(広告宣伝費), \n    data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-12323473   -100139    -69328     20239  19099811 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     1.005e+05  1.257e+04   7.995 1.58e-15 ***\nlag(研究開発費) 1.717e+01  2.639e-01  65.039  &lt; 2e-16 ***\nlag(広告宣伝費) 6.913e+00  5.164e-01  13.386  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 862200 on 5171 degrees of freedom\n  ( 23266 個の観測値が欠損のため削除されました )\nMultiple R-squared:  0.7853,    Adjusted R-squared:  0.7853 \nF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#つの仮説の検定-2",
    "href": "prezemi_2023_10_presen.html#つの仮説の検定-2",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "1つの仮説の検定",
    "text": "1つの仮説の検定\n\n結果の最後の行でF-statistic:  9460 on 2 and 5171 DF,  p-value: &lt; 2.2e-16とあり，自由度2と5171のF分布で検定した結果，検定統計量\\(F_0\\)は9460であり，p値はほぼゼロとなった。\nつまり，帰無仮説である「すべての回帰係数がゼロ」は棄却され，少なくとも一つの回帰係数はゼロではない，という対立仮説が採択された。\nt分布と同様にF分布を用いた検定の臨界値は基本関数qf()で計算できる。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#つの仮説の検定-3",
    "href": "prezemi_2023_10_presen.html#つの仮説の検定-3",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "1つの仮説の検定",
    "text": "1つの仮説の検定\nここでは、サンプルサイズは28440，説明変数の数は2なので，有意水準5％の両側検定を行う場合の\\(t\\)値は，\n\np = 0.05\nf1 &lt;- 2\nf2 &lt;- 28440\nqf(p,f1,f2,lower.tail =F)\n\n[1] 2.996048\n\n\nとなり，2.996という臨界値が得られた。 先ほどの推定結果からF値が9460と，臨界値を遙かに超える値であったため，帰無仮説は棄却された。"
  },
  {
    "objectID": "prezemi_2023_10_presen.html#変数",
    "href": "prezemi_2023_10_presen.html#変数",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "変数",
    "text": "変数\nadv_2023.csvの中に含まれる変数\n\nnames(df)\n\n [1] \"日経会社コード\" \"企業名称\"       \"決算期\"         \"決算種別\"      \n [5] \"連結基準\"       \"決算月数\"       \"業種\"           \"資産合計\"      \n [9] \"売上高\"         \"販管費\"         \"広告宣伝費\"     \"拡販費\"        \n[13] \"研究開発費\"     \"設備投資額\""
  },
  {
    "objectID": "prezemi_2023_10_presen.html#今後のスケジュール",
    "href": "prezemi_2023_10_presen.html#今後のスケジュール",
    "title": "プレゼミ2023  第10回 回帰分析",
    "section": "今後のスケジュール",
    "text": "今後のスケジュール\n最終確認\n\n12/04(月) 回帰分析 (11)\n12/11(月) 回帰分析の応用 (12)\n12/18(月) ロジスティック回帰分析 (13)\n12/25(月) 休講\n01/15(月) 因子分析 (14)\n01/15(月) 因子分析の実践+α (15)"
  },
  {
    "objectID": "test.html",
    "href": "test.html",
    "title": "プレゼミレポート",
    "section": "",
    "text": "はじめに"
  },
  {
    "objectID": "test.html#はじめに",
    "href": "test.html#はじめに",
    "title": "プレゼミレポート",
    "section": "",
    "text": "はじめに"
  },
  {
    "objectID": "test.html#回帰分析",
    "href": "test.html#回帰分析",
    "title": "プレゼミレポート",
    "section": "回帰分析",
    "text": "回帰分析\nデータの読み込み\n\nlibrary(tidyverse)\ndf &lt;- read_csv(\"https://so-ichi.com/adv_2023.csv\")"
  },
  {
    "objectID": "test.html#分析",
    "href": "test.html#分析",
    "title": "プレゼミレポート",
    "section": "分析",
    "text": "分析\n\nres &lt;- lm(売上高 ~ lag(研究開発費) + lag(広告宣伝費), data = df)\ncoef(res)\n\n    (Intercept) lag(研究開発費) lag(広告宣伝費) \n   1.004955e+05    1.716521e+01    6.913074e+00"
  },
  {
    "objectID": "test.html#結果の表",
    "href": "test.html#結果の表",
    "title": "プレゼミレポート",
    "section": "結果の表",
    "text": "結果の表\n\n#install.packages(\"modelsummary\")\nlibrary(modelsummary)\nmodelsummary(\n    res,\n    stars = TRUE,\n    fmt = '%.2f',\n    gof_omit = \"AIC|BIC|Log.Lik.\"\n    )\n\n\n\n\n (1)\n\n\n\n(Intercept)\n100495.49***\n\n\n\n(12569.41)\n\n\nlag(研究開発費)\n17.17***\n\n\n\n(0.26)\n\n\nlag(広告宣伝費)\n6.91***\n\n\n\n(0.52)\n\n\nNum.Obs.\n5174\n\n\nR2\n0.785\n\n\nR2 Adj.\n0.785\n\n\nRMSE\n861991.65\n\n\n\n\n + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001"
  }
]